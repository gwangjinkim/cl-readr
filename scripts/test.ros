#!/usr/bin/env ros
;; -*- mode: lisp; -*-
(require :asdf)

;; Load local .asd from repo root
(let* ((root (uiop:getcwd))
       (asd  (merge-pathnames "cl-readr.asd" root)))
  (asdf:load-asd asd))

(format t "~&[cl-readr] running tests...~%")

(handler-case
    (progn
      ;; IMPORTANT: test-system (not load-system) so :perform test-op runs
      (asdf:test-system :cl-readr)
      (format t "~&OK~%")
      (uiop:quit 0))
  (error (e)
    (format *error-output* "~&TESTS FAILED: ~a~%" e)
    (uiop:quit 1)))
